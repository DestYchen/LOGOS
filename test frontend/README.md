# SupplyHub Test Frontend

Новый интерфейс на Vite + React (shadcn/ui) поверх REST-эндпоинтов FastAPI (`/web/api`). Sidebar повторяет макет ChatGPT: меню в верхней части, ниже — скроллируемая история пакетов.

## Требования

- Node.js 18+
- npm / pnpm / yarn (примеры ниже используют npm)

## Быстрый старт

```bash
cd "test frontend"
npm install
```

### Дев-сервер

```bash
# Бэкенд по умолчанию ожидается на http://localhost:8000/web
npm run dev

# Если API доступно на другом хосте/порту
VITE_API_BASE=http://localhost:9000/web npm run dev
```

Dev-сервер запускается на http://localhost:5173 и проксирует `/web/*` на указанный `VITE_API_BASE`.

### Продакшен-сборка

```bash
npm run build
```

Бандлы попадают в `dist/`. FastAPI уже настроен на раздачу `test frontend/dist`, так что после сборки SPA доступно на `/web/app`.

Используйте `npm run preview`, чтобы проверить продовую сборку локально.

## Структура

- `src/pages` — ключевые экраны: Новый пакет, В очереди, Документ — исправление ошибок, Итоговая таблица, История.
- `src/components` — layout с сайдбаром, shadcn/ui элементы, вьюер документов, статусные бейджи.
- `src/lib/api.ts` — обёртки над `/web/api` и вспомогательные утилиты.
- `src/contexts/history-context.tsx` — кэш истории пакетов для сайдбара/роутов.

## Экранные сценарии

- **Новый пакет (`/new`)** — drag & drop зона, мгновенная валидация формата/размера, список выбранных файлов, «Продолжить» запускает загрузку и переводит в очередь.
- **В очереди (`/queue?batch=ID`)** — заблокированная форма с анимированной градиентной рамкой, отображает статусы документов и кнопки перехода к следующему шагу.
- **Документ — исправление ошибок (`/resolve/:batchId[/docIndex]`)** — левая панель с ошибками, правая панель с предпросмотром и зумом, кнопки «Удалить», «Сохранить и пересчитать», подтверждение/редактирование полей, прогресс по документам.
- **Итоговая таблица (`/table/:batchId`)** — таблица с подсветкой confidence, hover-превью, модальным редактированием и блоком ошибок правил, кнопка «Экспортировать отчёт».
- **История (`/history`)** — сгруппированный по статусам список пакетов с быстрыми переходами; также компактная версия отображается в сайдбаре.

## Связка с бэкендом

- Файлы летят в `POST /web/upload`.
- Очередь/история используют `GET /web/api/batches` и `GET /web/api/batches/:id`.
- Все действия (подтверждение полей, смена типа, пересчёт, удаление, завершение) вызывают новые JSON-роуты из `app/api/routes/web.py`.

После успешной загрузки запустите pipeline (Celery/worker), чтобы статусы обновлялись автоматически.
