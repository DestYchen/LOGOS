# SupplyHub Test Frontend

Новый интерфейс на Vite + React (shadcn/ui) поверх REST-эндпоинтов FastAPI (`/web/api`). Sidebar повторяет макет ChatGPT: навигация в верхней части, ниже — скроллируемая история пакетов.

## Требования

- Node.js 18+
- npm / pnpm / yarn (примеры используют npm)

## Быстрый старт

```bash
cd "test frontend"
npm install
```

### Режим разработки

```bash
# Бэкенд по умолчанию ожидается на http://localhost:8000/web
npm run dev

# Если API доступно на другом хосте/порту
VITE_API_BASE=http://localhost:9000/web npm run dev
```

Dev-сервер работает на http://localhost:5173 и проксирует `/web/*` (и `/files/*`) к указанному `VITE_API_BASE`.

### Продакшен-сборка

```bash
npm run build
```

Бандлы складываются в `dist/`. FastAPI уже настроен на раздачу `test frontend/dist`, поэтому после сборки SPA доступно на `/web/app`. Для локальной проверки используйте `npm run preview`.

## Структура

- `src/pages` — ключевые экраны: Новый пакет, В очереди, Документ — исправление ошибок, Итоговая таблица, История.
- `src/components` — layout с сайдбаром, элементы shadcn/ui, вьюер документов и статусные бейджи.
- `src/lib/api.ts` — обёртки над `/web/api`.
- `src/contexts/history-context.tsx` — кэш/CRUD истории пакетов для сайдбара и страницы истории.

## Основные сценарии

- **Новый пакет (`/new`)** — drag & drop загрузка, мгновенная валидация форматов и размеров, миниатюры файлов, кнопка «Продолжить» переносит в очередь.
- **В очереди (`/queue?batch=ID`)** — тот же визуал, но без возможности редактирования, вокруг — анимированная рамка, кнопка «Обработка». По завершении обработки выполняется автопереход в этап исправления.
- **Документ — исправление ошибок (`/resolve/:batchId[/docIndex]`)** — левая панель с обязательными/сомнительными полями, правая — предпросмотр с зумом. Поддерживаются пересчёт, удаление, подтверждение и прогресс по документам.
- **Итоговая таблица (`/table/:batchId`)** — ошибки и предупреждения выводятся компактными таблицами; каждое поле можно открыть в модальном редакторе и подтвердить. Переход назад не предлагается.
- **История (`/history`)** — спискок пакетов в обратном хронологическом порядке, доступны быстрый переход и удаление.

## Интеграция с бэкендом

- Загрузка — `POST /web/upload`.
- Статусы/детали — `GET /web/api/batches`, `GET /web/api/batches/:id`.
- Действия ревьюера (подтверждения, пересчёт, удаление, завершение) — новые JSON-роуты из `app/api/routes/web.py`.

После загрузки пакетов убедитесь, что Celery воркер активен — так статусы обновляются автоматически, а очередь срабатывает корректно.
