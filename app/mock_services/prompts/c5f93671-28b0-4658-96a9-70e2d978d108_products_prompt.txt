MODEL: openai/gpt-oss-20b
BRANCH: PRODUCTS

=== SYSTEM ===
You convert OCR tokens into structured JSON describing product rows.

Input:

A JSON template ("PRODUCT TEMPLATE") that lists every per-product field.
Each field is an object with:
"value": string (initially "").
"token_refs": array of token ids (initially []).

Optional "FIELD HINTS" that describe how to extract product-related data.

A list of OCR tokens ("RAW TOKENS"), each given as:
token_id:
token_text

Optional "TABLE CANDIDATES" block that contains raw HTML/delimited table tokens.

Your task:

Create product_1, product_2, ... for every real product row you find in the RAW TOKENS.
For each product_N, copy the PRODUCT TEMPLATE exactly (same child fields) and fill only "value" and "token_refs".
When you set a non-empty "value", add the token ids you used to "token_refs"; otherwise leave [].
If a field is unknown, leave "value" as "".
Copy text EXACTLY as it appears in the tokens/tables. Do NOT invent data.
The value can be, but is not guaranteed to be a FULL section. There can be multiple values in one section (one token id) or a value can be spread out between different sections. Basically your goal is to accurately fill the value, following the hints, and only then you should start to care about token_refs, to find the one that best corresponds to this value.
Output MUST be a single valid JSON object with one top-level key "products" containing product_1, product_2, ...
Return ONLY the completed JSON, with no explanations or extra text.

=== USER ===
-- part 1 (text) --
=== PRODUCT TEMPLATE ===
{"name_product": {"value": "", "token_refs": []}, "latin_name": {"value": "", "token_refs": []}, "size_product": {"value": "", "token_refs": []}, "unit_box": {"value": "", "token_refs": []}, "packages": {"value": "", "token_refs": []}, "net_weight": {"value": "", "token_refs": []}, "net_weight_with_glaze": {"value": "", "token_refs": []}, "net_weight_with_ice": {"value": "", "token_refs": []}, "net_weight_with_glaze_and_pack": {"value": "", "token_refs": []}, "gross_weight": {"value": "", "token_refs": []}, "price_per_unit": {"value": "", "token_refs": []}, "total_price": {"value": "", "token_refs": []}, "factory_number": {"value": "", "token_refs": []}, "date_of_production": {"value": "", "token_refs": []}}
=== END PRODUCT TEMPLATE ===
-- part 2 (text) --
=== FIELD HINTS ===
doc_type: PACKING_LIST
products: Блок «products» расширяемый: создай product_1, product_2, … в порядке следования товарных строк в документе. Для каждой позиции заполняй все доступные поля. Если какой-то атрибут указан один раз общим блоком для нескольких строк (например, один латинский вид), продублируй его во все соответствующие product_i. В token_refs укажи ссылки на исходные фрагменты текста/таблицы, из которых собрано значение.
products[*].name_product: Возьми коммерческое наименование из описания позиции («Product», «Description of goods»), например «FROZEN ATLANTIC SALMON FILLET …». Объедини переносы в одну строку. Добавь текст в products[i].name_product.
products[*].latin_name: Если возле описания указан латинский вид (часто в скобках, например «SALMO SALAR»), извлеки его отдельно и добавь в products[i].latin_name. Если не указан — оставь пустым.
products[*].size_product: Извлеки размер/калибр (например, «3-4 LB (1.3-1.8 KG)», «80/120»). Сохрани формат как в источнике и добавь в products[i].size_product.
products[*].unit_box: Если явно обозначена учётная/ценовая единица или единица упаковки («Unit», «per carton», «per kg», «CASE» и т.п.) — извлеки её и добавь в products[i].unit_box. Если не указана — оставь пустым.
products[*].packages: Извлеки количество мест/упаковок по меткам «Cases», «Cartons», «Packages», «No. of packages». Если указан и тип тары — сохрани в одной строке (например, «1375 CASES»). Добавь значение в products[i].packages.
products[*].net_weight: Возьми нетто («Net Weight», «NET»). Сохрани число и единицу («KG» и т.п.) в исходном формате (точки/запятые). Добавь значение в products[i].net_weight.
products[*].net_weight_with_glaze: Если указано «Net Weight with Glazing» — извлеки это значение отдельно от обычного нетто и добавь его в products[i].net_weight_with_glaze. Если отсутствует — оставь пустым.
products[*].net_weight_with_ice: Если указано «Net Weight with Ice» — извлеки это значение и добавь в products[i].net_weight_with_ice. Если отсутствует — оставь пустым.
products[*].net_weight_with_glaze_and_pack: Извлеки показатель вида «Net Weight with Glazing and Primary [Packing]» (или аналогичную формулировку) как отдельное значение. Добавь его в products[i].net_weight_with_glaze_and_pack. Если отсутствует — оставь пустым.
products[*].gross_weight: Возьми брутто («Gross Weight», «G.W.»). Сохрани число и единицу как в документе. Добавь значение в products[i].gross_weight.
products[*].price_per_unit: Если в пакинг-листе указана цена за единицу (встречается не всегда), извлеки её с валютой и исходным форматированием и добавь в products[i].price_per_unit. Если цены нет — оставь пустым.
products[*].total_price: Если в пакинг-листе указана итоговая стоимость по позиции, извлеки её с валютой и форматом и добавь в products[i].total_price. Если суммы нет — оставь пустым (не вычисляй).
products[*].factory_number: Извлеки номер завода/предприятия производителя (например, «Establishment No», «Factory No», регистрационный номер цеха), если он указан для позиции. Добавь значение в products[i].factory_number.
products[*].date_of_production: Извлеки дату производства по позиции («Date of production», «Production date», «Дата производства»). Если дат несколько (диапазон) — сохрани как в источнике одной строкой. Добавь значение в products[i].date_of_production.
=== END FIELD HINTS ===
-- part 3 (text) --
=== RAW TOKENS ===
p0_t0:
Salmones Antártica S.A.

p0_t1:
PACKING LIST

p0_t2:
SHIPPER: SALMONES ANTARTICA S.A.

p0_t3:
AV. PROVIDENCIA 2653 PISO 15 SANTIAGO-CHILE

p0_t4:
CONSIGNEE: OOO "MOREODOR"

p0_t5:
117036, MOSCOW, PROFSOYUZNAYA STEET, 3

p0_t6:
OFFICE 412, RUSSIA

p0_t7:
PRODUCER: SALMONES ANTARTICA S.A.

p0_t8:
CONTAINER NUMBER: PONU4832160

p0_t9:
VESSEL: LEXA MAERSK 935N

p0_t10:
SHIPPED ON BOARD : 04-09-2019

p0_t11:
ETA: 04-10-2019

p0_t12:
PRODUCTION PLANT: SALMONES ANTARTICA S.A. 10735

p0_t13:
PRODUCTION: RAINBOW TROUT IN kg and $PER KG

| PRODUCT | QUALITY | SIZE | PRODUCTION DATE | KG/BOX | CASES | NET. WEIGHT | TECNICAL WEIGHT | GROSS WEIGHT | BEST BEFORE |
|---|---|---|---|---|---|---|---|---|---|
| FROZEN RAINBOW TROUT HG | PREM | 6-9 LB (2,7 - 4,0 KG) | 05-06-2019 | 25 | 1 | 25,00 | 26,25 | 27,50 | 05-06-2021 |
| FROZEN RAINBOW TROUT HG | PREM | 6-9 LB (2,7 - 4,0 KG) | 25-07-2019 | 25 | 104 | 2.600,00 | 2.730,00 | 2.860,00 | 25-07-2021 |
| FROZEN RAINBOW TROUT HG | PREM | 6-9 LB (2,7 - 4,0 KG) | 26-07-2019 | 25 | 227 | 5.675,00 | 5.958,75 | 6.242,50 | 26-07-2021 |
| FROZEN RAINBOW TROUT HG | PREM | 6-9 LB (2,7 - 4,0 KG) | 27-07-2019 | 25 | 161 | 4.025,00 | 4.226,25 | 4.427,50 | 27-07-2021 |
| FROZEN RAINBOW TROUT HG | PREM | 6-9 LB (2,7 - 4,0 KG) | 29-07-2019 | 25 | 56 | 1.400,00 | 1.470,00 | 1.540,00 | 29-07-2021 |
| FROZEN RAINBOW TROUT HG | PREM | 6-9 LB (2,7 - 4,0 KG) | 30-07-2019 | 25 | 200 | 5.000,00 | 5.250,00 | 5.500,00 | 30-07-2021 |
| FROZEN RAINBOW TROUT HG | PREM | 6-9 LB (2,7 - 4,0 KG) | 31-07-2019 | 25 | 83 | 2.075,00 | 2.178,75 | 2.282,50 | 31-07-2021 |
| **SUBTOTAL** |  |  |  |  | **832** | **20.800,00** | **21.

p0_t14:
ISSUE 04-09-2019

p0_t15:
JOHANNA OSORIO
COMMERCIAL ASSISTANT

p0_t16:
SALMONES ANTARTICA S.A.
=== END RAW TOKENS ===
-- part 4 (text) --
=== TABLE CANDIDATES ===
p0_t13:
PRODUCTION: RAINBOW TROUT IN kg and $PER KG

| PRODUCT | QUALITY | SIZE | PRODUCTION DATE | KG/BOX | CASES | NET. WEIGHT | TECNICAL WEIGHT | GROSS WEIGHT | BEST BEFORE |
|---|---|---|---|---|---|---|---|---|---|
| FROZEN RAINBOW TROUT HG | PREM | 6-9 LB (2,7 - 4,0 KG) | 05-06-2019 | 25 | 1 | 25,00 | 26,25 | 27,50 | 05-06-2021 |
| FROZEN RAINBOW TROUT HG | PREM | 6-9 LB (2,7 - 4,0 KG) | 25-07-2019 | 25 | 104 | 2.600,00 | 2.730,00 | 2.860,00 | 25-07-2021 |
| FROZEN RAINBOW TROUT HG | PREM | 6-9 LB (2,7 - 4,0 KG) | 26-07-2019 | 25 | 227 | 5.675,00 | 5.958,75 | 6.242,50 | 26-07-2021 |
| FROZEN RAINBOW TROUT HG | PREM | 6-9 LB (2,7 - 4,0 KG) | 27-07-2019 | 25 | 161 | 4.025,00 | 4.226,25 | 4.427,50 | 27-07-2021 |
| FROZEN RAINBOW TROUT HG | PREM | 6-9 LB (2,7 - 4,0 KG) | 29-07-2019 | 25 | 56 | 1.400,00 | 1.470,00 | 1.540,00 | 29-07-2021 |
| FROZEN RAINBOW TROUT HG | PREM | 6-9 LB (2,7 - 4,0 KG) | 30-07-2019 | 25 | 200 | 5.000,00 | 5.250,00 | 5.500,00 | 30-07-2021 |
| FROZEN RAINBOW TROUT HG | PREM | 6-9 LB (2,7 - 4,0 KG) | 31-07-2019 | 25 | 83 | 2.075,00 | 2.178,75 | 2.282,50 | 31-07-2021 |
| **SUBTOTAL** |  |  |  |  | **832** | **20.800,00** | **21.
=== END TABLE CANDIDATES ===
