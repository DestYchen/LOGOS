MODEL: openai/gpt-oss-20b
BRANCH: PRODUCTS

=== SYSTEM ===
You convert OCR tokens into structured JSON describing product rows.

Input:

A JSON template ("PRODUCT TEMPLATE") that lists every per-product field.
Each field is an object with:
"value": string (initially "").
"token_refs": array of token ids (initially []).

Optional "FIELD HINTS" that describe how to extract product-related data.

A list of OCR tokens ("RAW TOKENS"), each given as:
token_id:
token_text

Optional "TABLE CANDIDATES" block that contains raw HTML/delimited table tokens.

Your task:

Create product_1, product_2, ... for every real product row you find in the RAW TOKENS.
For each product_N, copy the PRODUCT TEMPLATE exactly (same child fields) and fill only "value" and "token_refs".
When you set a non-empty "value", add the token ids you used to "token_refs"; otherwise leave [].
If a field is unknown, leave "value" as "".
Copy text EXACTLY as it appears in the tokens/tables. Do NOT invent data.
The value can be, but is not guaranteed to be a FULL section. There can be multiple values in one section (one token id) or a value can be spread out between different sections. Basically your goal is to accurately fill the value, following the hints, and only then you should start to care about token_refs, to find the one that best corresponds to this value.
Output MUST be a single valid JSON object with one top-level key "products" containing product_1, product_2, ...
Return ONLY the completed JSON, with no explanations or extra text.

=== USER ===
-- part 1 (text) --
=== PRODUCT TEMPLATE ===
{"name_product": {"value": "", "token_refs": []}, "latin_name": {"value": "", "token_refs": []}, "size_product": {"value": "", "token_refs": []}, "unit_box": {"value": "", "token_refs": []}, "packages": {"value": "", "token_refs": []}, "net_weight": {"value": "", "token_refs": []}, "gross_weight": {"value": "", "token_refs": []}, "price_per_unit": {"value": "", "token_refs": []}, "total_price": {"value": "", "token_refs": []}}
=== END PRODUCT TEMPLATE ===
-- part 2 (text) --
=== FIELD HINTS ===
doc_type: PROFORMA
products: Блок «products» расширяемый: создай product_1, product_2, … по количеству товарных строк в документе, сохраняя их порядок. Для каждой позиции заполняй все доступные поля. Если общий атрибут указан один раз (например, один латинский вид для всех строк), продублируй его в соответствующие product_i. В token_refs укажи ссылки на исходные фрагменты (ячейки/строки), из которых собрано значение.
products[*].name_product: Возьми коммерческое наименование из колонки «Description of Goods»/«Descripción de la Mercadería» (например, «FROZEN ATLANTIC SALMON FILLET TRIM D VP PREMIUM …»). Объедини переносы в одну строку. Добавь текст в products[i].name_product.
products[*].latin_name: Если рядом с наименованием указан латинский вид в скобках (например, «SALMO SALAR»), извлеки его отдельно и добавь в products[i].latin_name. Если отсутствует — оставь пустым.
products[*].size_product: Извлеки размер/калибр (например, «3–4 LB (1.3–1.8 KG)», «80/120»). Если указаны обе системы измерений, сохрани обе. Добавь строку в products[i].size_product.
products[*].unit_box: Зафиксируй учётную/ценовую единицу, если она явно указана («per carton», «per kg», «unit», «Price per …»). Добавь значение в products[i].unit_box; если не указана — оставь пустым.
products[*].packages: Извлеки количество мест/упаковок («Packages», «Cases», «Cartons»). Если в проформе указан только вес/количество в кг без количества мест — оставь поле пустым (не выводи по косвенным признакам). Добавь значение в products[i].packages.
products[*].net_weight: Возьми массу нетто по позиции («Net weight», «Quantity/KG» если это явный нетто). Сохрани число и единицу в исходном формате (точки/запятые) и добавь значение в products[i].net_weight.
products[*].gross_weight: Если указана масса брутто («Gross weight»/«G.W.») по позиции — извлеки её. Сохрани число и единицу в исходном формате. Добавь значение в products[i].gross_weight. Если брутто отсутствует — оставь пустым.
products[*].price_per_unit: Найди цену за единицу по меткам «Unit Price», «Precio Unitario», «Price per …». Сохрани валюту и формат числа ровно как в документе. Добавь значение в products[i].price_per_unit.
products[*].total_price: Извлеки построчную сумму («Line total», «Amount», иногда совпадает с «Total …» в строке). Если явного значения нет, вычисли как количество/вес × price_per_unit, сохранив валюту и формат. Добавь сумму в products[i].total_price.
=== END FIELD HINTS ===
-- part 3 (text) --
=== RAW TOKENS ===
p0_t0:
KOHTPAKT No. NORDMO25

p0_t1:
«19» May 2025 г.

p0_t2:
ООО «Мореодор», Российская Федерация, в лице Генерального директора Андрюнова В.В., действующего на основании устава, именуемая в дальнейшем «Покупатель», с одной стороны, и компания "Noordzee Su Ürünleri Ihr. San. ve Tic. A.Ş», Турция, в лице Управляющего директора Ahmet Tolga Vural, действующего на основании устава, именуемая в дальнейшем «Продавец», с другой стороны, заключили настоящий Контракт о нижеследующем:

p0_t3:
# 1. Предмет Контракта

p0_t4:
Продавец продаст, а Покупатель купит рыбу свежемороженую и(или) охлажденную и(или) морестродукты и(или) мясо свежемороженое и(или) охлажденное, а также иные продукты питания (далее – Товар), в ассортименте, количестве и по ценам, указанным в Спецификациях и Инвойсах к настоящему Контракту. Стороны вправе указать предварительные условия сделки (в т.ч. ассортимент, количество и цены Товара) в Проформах.

p0_t5:
2. Цена Товара и общая сумма Контракта

p0_t6:
2.1. Предварительные цены на Товар указываются в Проформах. Окончательные цены на Товары согласовываются в Спецификациях и/или Инвойсах к настоящему Контракту.

p0_t7:
2.2. Общая стоимость товаров, поставляемых по данному Контракту, составляет 10 000 000.00 (десять миллионов) долларов США.

p0_t8:
2.3. Контракт действует в течение 3 (трех) лет с даты его подписания (дата подписания соответствует дате составления Контракта).

p0_t9:
2.4. Обязательства Сторон возникшие до даты окончания действия Контракта подлежат обязательному исполнению в согласованных порядке и сроки.

p0_t10:
3. Условия поставки

p0_t11:
3.1. Условия поставки Товара по Контракту Стороны согласуют в Проформах, Спецификации и указывают в Инвойсе относительно каждой партии Товара. При этом все налоги, таможенные пошлины, сборы и другие расходы, связанные с исполнением настоящего Контракта и взимаемые в стране Производителя, оплачивает Продавец, а аналогичные расходы в стране Покупателя оплачивает Покупатель, за исключением оплаты простоев, хранения и прочих затрат, которые вызваны, не своевременным предоставлением документов Продавцом Покупателю или предоставление не верно оформленных документов.

p0_t12:
3.2. Продавец не выполнил свои обязательства по продаже и поставки товара. Покупателю если:

p0_t13:
CONTRACT No. NORDMO25

p0_t14:
19 May, 2025

p0_t15:
LLC "Moreodor", Russian Federation, on behalf of
general director Andrianov V.V., hereinafter referred to
as "the Buyer", acting on the basis of the charter on one
part and "Noordzee Su Ürünleri Ihr. San. ve Tic. A.Ş.",

Türkiye, represented by the Managing Director Ahmet
Tolga Vural, acting on the basis of the charter,

hereinafter referred to as "the Seller", on the other part,
have concluded this Contract as provided herein below:

p0_t16:
1. Subject of the Contract

p0_t17:
The Seller shall sell and the Buyer shall buy fresh-frozen and/or chilled fish and/or seafood and/or fresh-frozen and/or chilled meat, as well as other food products (hereinafter referred to as the Goods), in the assortment, quantity and at the prices specified in the Specifications and Invoices to this Contract. The Parties shall have the right to specify the preliminary terms of the transaction (including the assortment, quantity and prices of the Goods) in the Proformas.

p0_t18:
2. Price for the Goods and Total Value of the Contract

p0_t19:
2.1. The preliminary prices for the Goods are indicated in the Proforma. The final prices of the Goods are agreed in the Specifications and/or Invoices to this Contract.

p0_t20:
2.2. Total value of the Goods supplied under the present contract shall be 10 000 000.00 (ten million) US dollars.

p0_t21:
2.3. The contract shall be valid for three (3) years from the date of its signature (the date of signature corresponds to the date of conclusion of the Contract).

p0_t22:
2.4. The obligations of the Parties arising before the end of the Contract shall be binding in accordance with agreed procedures and time limits.

p0_t23:
3. Terms of Delivery

p0_t24:
3.1. The terms of delivery of the Goods under the Contract shall be agreed by the Parties in the Proformas, Specifications and indicated in the Invoice for each consignment of the Goods. All taxes, customs duties, fees and other expenses related to the performance of this Contract and collected in the country of the Manufacturer, is paid by the Seller, and similar costs in the country of the Buyer pays the Buyer, except for payment of imposts, storage and other costs that are caused by the Seller not providing documents to the Buyer in a timely manner or providing documents that are not properly executed.

p0_t25:
3.2. The seller has not fulfilled its obligations to sell and deliver the goods to the buyer if:

p0_t26:
- Goods detained by border veterinary authorities due to incorrect documents and (or) sanctions against the sender (producer of the goods), and if the delivered

p0_t28:
1
=== END RAW TOKENS ===
