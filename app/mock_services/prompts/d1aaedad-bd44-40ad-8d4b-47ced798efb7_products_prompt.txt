MODEL: openai/gpt-oss-20b
BRANCH: PRODUCTS

=== SYSTEM ===
You convert OCR tokens into structured JSON describing product rows.

Input:

A JSON template ("PRODUCT TEMPLATE") that lists every per-product field.
Each field is an object with:
"value": string (initially "").
"token_refs": array of token ids (initially []).

Optional "FIELD HINTS" that describe how to extract product-related data.

A list of OCR tokens ("RAW TOKENS"), each given as:
token_id:
token_text

Optional "TABLE CANDIDATES" block that contains raw HTML/delimited table tokens.

Your task:

Create product_1, product_2, ... for every real product row you find in the RAW TOKENS.
For each product_N, copy the PRODUCT TEMPLATE exactly (same child fields) and fill only "value" and "token_refs".
When you set a non-empty "value", add the token ids you used to "token_refs"; otherwise leave [].
If a field is unknown, leave "value" as "".
Copy text EXACTLY as it appears in the tokens/tables. Do NOT invent data.
The value can be, but is not guaranteed to be a FULL section. There can be multiple values in one section (one token id) or a value can be spread out between different sections. Basically your goal is to accurately fill the value, following the hints, and only then you should start to care about token_refs, to find the one that best corresponds to this value.
Output MUST be a single valid JSON object with one top-level key "products" containing product_1, product_2, ...
Return ONLY the completed JSON, with no explanations or extra text.

=== USER ===
-- part 1 (text) --
=== PRODUCT TEMPLATE ===
{"name_product": {"value": "", "token_refs": []}, "latin_name": {"value": "", "token_refs": []}, "size_product": {"value": "", "token_refs": []}, "unit_box": {"value": "", "token_refs": []}, "packages": {"value": "", "token_refs": []}, "price_per_unit": {"value": "", "token_refs": []}, "total_price": {"value": "", "token_refs": []}, "net_weight": {"value": "", "token_refs": []}, "gross_weight": {"value": "", "token_refs": []}}
=== END PRODUCT TEMPLATE ===
-- part 2 (text) --
=== FIELD HINTS ===
doc_type: EXPORT_DECLARATION
products: Блок «products» расширяемый: создай product_1, product_2, … по количеству товарных строк (ITEM 1, ITEM 2, …) в разделе описания товаров. Соблюдай порядок из документа. Для каждой позиции заполняй все доступные поля; если общий атрибут указан один раз (например, общий латинский вид), продублируй его в соответствующие product_i. В token_refs указывай ссылки на исходные фрагменты текста/таблицы, из которых собрано значение.
products[*].name_product: Возьми коммерческое описание из блока «Descripción de mercancías / Description of goods / Nombre». Если описание разбито на несколько строк (включая «Observaciones»), объедини в одну строку. Добавь текст в products[i].name_product.
products[*].latin_name: Если рядом с описанием указан латинский вид в скобках (например, «SALMO SALAR»), извлеки его отдельно и добавь в products[i].latin_name. Если нет — оставь пустым.
products[*].size_product: Извлеки размер/калибр (напр., «Calibre 3–4 LBS», «1.3–1.8 KG», «80/120»). Сохрани запись как в документе и добавь в products[i].size_product.
products[*].unit_box: Возьми единицу учёта/измерения из соответствующей графы (напр., «U. Medida / Unit», значения вроде «KG», «CASE», «PCS», иногда «KN» = kilos netos). Добавь значение в products[i].unit_box.
products[*].packages: Укажи количество мест/упаковок по графе «Number and kind of packages / Cantidad de bultos / Cases/Cartons». Если тип тары указан (например, «1375 CAJAS»), сохрани число и тип в одной строке. Добавь значение в products[i].packages.
products[*].price_per_unit: Возьми цену за единицу из графы «Precio unitario FOB / Unit price». Сохраняй валюту и формат числа (точка/запятая) как в документе. Добавь значение в products[i].price_per_unit.
products[*].total_price: Возьми построчную сумму (обычно «Valor FOB» для строки). Если явного значения нет, вычисли как количество × цена за единицу, сохранив формат и валюту. Добавь сумму в products[i].total_price.
products[*].net_weight: Извлеки нетто по позиции. В некоторых формах Чили нетто обозначают «KN» (kilos netos) в табличной части; также могут использовать «Peso Neto / Net weight». Сохрани число и единицу как в документе. Добавь значение в products[i].net_weight.
products[*].gross_weight: Извлеки брутто по позиции из поля «Peso Bruto / Gross weight». Сохраняй формат числа и единицу. Добавь значение в products[i].gross_weight.
=== END FIELD HINTS ===
-- part 3 (text) --
=== RAW TOKENS ===
p0_t0:
GOBIERNO DE CHILE

p0_t1:
SERVICIO NACIONAL DE ADUANAS

p0_t2:
DOCUMENTO UNICO DE SALIDA

p0_t4:
Número Aceptación

p0_t5:
9129269-6

p0_t6:
Fecha

p0_t7:
30/08/2019

p0_t9:
Ref.Cite.: GD: 681711/F.19246

p0_t10:
PED: PDAFC

p0_t11:
01/10/2019
=== END RAW TOKENS ===
