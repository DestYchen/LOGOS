MODEL: google/gemma-3-27b
BRANCH: PRODUCTS

=== SYSTEM ===
You convert OCR tokens into structured JSON describing product rows.

Input:

A JSON template ("PRODUCT TEMPLATE") that lists every per-product field.
Each field is an object with:
"value": string (initially "").
"token_refs": array of token ids (initially []).

Optional "FIELD HINTS" that describe how to extract product-related data.

A list of OCR tokens ("RAW TOKENS"), each given as:
token_id:
token_text

Optional "TABLE CANDIDATES" block that contains raw HTML/delimited table tokens.

Your task:

Create product_1, product_2, ... for every real product row you find in the RAW TOKENS.
For each product_N, copy the PRODUCT TEMPLATE exactly (same child fields) and fill only "value" and "token_refs".
When you set a non-empty "value", add the token ids you used to "token_refs"; otherwise leave [].
If a field is unknown, leave "value" as "".
Copy text EXACTLY as it appears in the tokens/tables. Do NOT invent data.
The value can be, but is not guaranteed to be a FULL section. There can be multiple values in one section (one token id) or a value can be spread out between different sections. Basically your goal is to accurately fill the value, following the hints, and only then you should start to care about token_refs, to find the one that best corresponds to this value.
Output MUST be a single valid JSON object with one top-level key "products" containing product_1, product_2, ...
Return ONLY the completed JSON, with no explanations or extra text.

=== USER ===
-- part 1 (text) --
=== PRODUCT TEMPLATE ===
{"name_product": {"value": "", "token_refs": []}, "latin_name": {"value": "", "token_refs": []}, "size_product": {"value": "", "token_refs": []}, "unit_box": {"value": "", "token_refs": []}, "packages": {"value": "", "token_refs": []}, "price_per_unit": {"value": "", "token_refs": []}, "total_price": {"value": "", "token_refs": []}, "net_weight": {"value": "", "token_refs": []}, "gross_weight": {"value": "", "token_refs": []}}
=== END PRODUCT TEMPLATE ===
-- part 2 (text) --
=== FIELD HINTS ===
doc_type: CERTIFICATE_OF_ORIGIN
products: Блок «products» расширяемый: создай product_1, product_2, … по количеству товарных строк. Соблюдай порядок следования. Для каждой позиции заполняй все доступные поля и указывай token_refs для исходных фрагментов. Если часть атрибутов указана общим блоком (например, один HS-код для всех), дублируй эти значения во все соответствующие product_i.
products[*].name_product: Возьми коммерческое наименование из описания товара (например, «FROZEN ATLANTIC SALMON FILLET»). Если описание многострочное — объедини в одну строку. Латинское видовое имя вынеси отдельно в latin_name. Добавь текст в products[i].name_product.
products[*].latin_name: Если рядом с описанием указано латинское видовое название в скобках (например, «SALMO SALAR»), извлеки его и добавь в products[i].latin_name. Если нет — оставь пустым.
products[*].size_product: Если указан размер/градация (например, «3–4 LB», «80/120», «1.3–1.8 KG»), извлеки как единую строку и добавь в products[i].size_product. Если размер не указан — оставь пустым.
products[*].unit_box: Если явно указана учётная/ценовая единица («per carton», «per kg», «unit»), извлеки её и добавь в products[i].unit_box. Если единица не указана в CoO — оставь пустым (не выдумывай).
products[*].packages: Извлеки количество мест/упаковок по пометкам «Number and kind of packages», «Cases/Cartons/Packages». Сохрани число и при необходимости тип (например, «1375 CASES») в одной строке. Добавь значение в products[i].packages.
products[*].price_per_unit: Если в CoO указана цена за единицу (встречается редко), извлеки её с валютой/форматом как в документе и добавь в products[i].price_per_unit. Если цены нет — оставь пустым.
products[*].total_price: Если в CoO указана итоговая стоимость по позиции (редко), извлеки её с валютой/форматом как в документе и добавь в products[i].total_price. Если суммы нет — оставь пустым (не вычисляй).
products[*].net_weight: Извлеки нетто по позиции («NET KGS», «Net weight», возможно внутри описания). Сохраняй число и единицу как в документе. Добавь значение в products[i].net_weight.
products[*].gross_weight: Извлеки брутто по позиции из поля «Gross weight»/«Gross weight or other quantity». Сохраняй формат числа и единицу. Добавь значение в products[i].gross_weight.
=== END FIELD HINTS ===
-- part 3 (text) --
=== RAW TOKENS ===
p0_t0:
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.

p0_t1:
QINGDAO CALYPSO FOOD CO.,LTD

ADD NO. 50 HONGKONG MIDDLE ROAD, SHINAN DISTRICT, QINGDAO, SHANDONG, CHINA.

p0_t2:
2. Consignee

p0_t3:
OOO"MOREODOR"
117292,MOSCOW,PROFSOYUZNAYA
STREET,3,OFFICE 412,RUSSIA

p0_t4:
3. Means of transport and route

p0_t5:
FROM RIZHAO, CHINA TO VLADIVOSTOK, RUSSIAN
FEDERATION BY SEA

p0_t6:
4. Destination port

p0_t7:
RUSSIAN FEDERATION

p0_t8:
Certificate No.2024129763238MU09

p0_t9:
CERTIFICATE OF ORIGIN

p0_t10:
5. For certifying authority use only

p0_t11:
6. Marks and numbers
N/M

p0_t12:
Number and kind of packages; description of goods

ONE THOUSAND SEVEN HUNDRED AND THIRTY
OF FROZEN GREEN MUSSELS IN THE HALF SIZE
(CANALICULUS) SIZE 30-45 PCS/KG,

TOTAL N.W.:20856.00KGS

*** *** *** *** ***

CONTAINER: MEDU9763238

p0_t13:
8.H.S.Code

p0_t14:
03.07

p0_t15:
9. Quantity

p0_t16:
23393.48KGS

G. W.

p0_t17:
10.Number
and date of invoices
2311MU-9
DEC. 23, 2024

p0_t18:
11. Declaration by the producer

p0_t19:
The undersigned hereby declares that the above details and statements are correct that all the goods were produced in China and that they comply with the Rules of Origin of People's Republic of China

p0_t20:
Qingdao, China, DEC. 23, 2024

p0_t22:
Place and date. Signature and stamp of authorized signatory

p0_t23:
12.Certification

p0_t24:
It is hereby certified the declaration by the producer is correct.

p0_t25:
Qingdao, China, DEC. 23, 2024

p0_t27:
Place and date, signature and stamp of certifying authority
=== END RAW TOKENS ===
