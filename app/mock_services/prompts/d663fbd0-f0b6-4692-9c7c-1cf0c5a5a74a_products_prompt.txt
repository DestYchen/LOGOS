MODEL: openai/gpt-oss-20b
BRANCH: PRODUCTS

=== SYSTEM ===
You convert OCR tokens into structured JSON describing product rows.

Input:

A JSON template ("PRODUCT TEMPLATE") that lists every per-product field.
Each field is an object with:
"value": string (initially "").
"token_refs": array of token ids (initially []).

Optional "FIELD HINTS" that describe how to extract product-related data.

A list of OCR tokens ("RAW TOKENS"), each given as:
token_id:
token_text

Optional "TABLE CANDIDATES" block that contains raw HTML/delimited table tokens.

Your task:

Create product_1, product_2, ... for every real product row you find in the RAW TOKENS.
For each product_N, copy the PRODUCT TEMPLATE exactly (same child fields) and fill only "value" and "token_refs".
When you set a non-empty "value", add the token ids you used to "token_refs"; otherwise leave [].
If a field is unknown, leave "value" as "".
Copy text EXACTLY as it appears in the tokens/tables. Do NOT invent data.
The value can be, but is not guaranteed to be a FULL section. There can be multiple values in one section (one token id) or a value can be spread out between different sections. Basically your goal is to accurately fill the value, following the hints, and only then you should start to care about token_refs, to find the one that best corresponds to this value.
Output MUST be a single valid JSON object with one top-level key "products" containing product_1, product_2, ...
Return ONLY the completed JSON, with no explanations or extra text.

=== USER ===
-- part 1 (text) --
=== PRODUCT TEMPLATE ===
{"name_product": {"value": "", "token_refs": []}, "latin_name": {"value": "", "token_refs": []}, "size_product": {"value": "", "token_refs": []}, "unit_box": {"value": "", "token_refs": []}, "packages": {"value": "", "token_refs": []}, "price_per_unit": {"value": "", "token_refs": []}, "total_price": {"value": "", "token_refs": []}}
=== END PRODUCT TEMPLATE ===
-- part 2 (text) --
=== FIELD HINTS ===
doc_type: INVOICE
products: Блок «products» расширяемый: создай product_1, product_2, … по количеству товарных строк/позиций в инвойсе, соблюдая порядок в документе. Для каждого продукта заполняй все вложенные поля. Если часть атрибутов указана общим блоком (например, единая латинская номенклатура для нескольких строк), дублируй её значение в соответствующие product_i. В token_refs указывай ссылки на исходные токены/фрагменты, из которых собрано значение.
products[*].name_product: Возьми коммерческое наименование товара из колонки «Description of goods»/«Description». Если описание многострочное, объедини строки с пробелами. Не включай латинское название (его помести в latin_name). Добавь текст в products[i].name_product.
products[*].latin_name: Извлеки латинское (биологическое) название рядом с описанием, часто в скобках (напр., «SALMO SALAR»). Сохрани регистр, как в документе, и добавь текст в products[i].latin_name.
products[*].size_product: Извлеки размер/градацию товара (например, «3-4 LB (1.3-1.8 KG)», «80/120» и т.п.). Если указаны и имперские, и метрические единицы, сохрани обе. Добавь текст в products[i].size_product.
products[*].unit_box: Укажи ценовую/учётную единицу (например, «per carton», «per kg», «per case»). Если явно указано «Price per carton/kg/etc», используй эту единицу. Добавь значение в products[i].unit_box.
products[*].packages: Извлеки количество мест/упаковок («Cases», «Cartons», «Packages», «Boxes»). Сохрани число так, как в документе (учитывай разделители). Добавь число в products[i].packages.
products[*].price_per_unit: Извлеки цену за единицу (напр., «Price per carton 169,50»). Сохрани валюту, если указана, и формат числа как в документе (точка/запятая). Добавь значение в products[i].price_per_unit.
products[*].total_price: Извлеки построчную сумму. Добавь сумму в products[i].total_price.
=== END FIELD HINTS ===
-- part 3 (text) --
=== RAW TOKENS ===
p0_t0:
<table><tr><td>CUSTOMER & PLACE OF DELIVERY</td></tr><tr><td>LLC "Moreodor"<br>117292, Moscow, Profsoyuznaya street, 3, office 412<br>Russian Federation<br>INN 7727734159</td></tr></table>

<table><tr><td>EXPORTER</td></tr><tr><td>Noordzee Su Urünleri Ihracatı Sanayi ve Ticaret A.Ş.<br>KOCAKIŞLA MAH. GÜLLÜK YOLU NO:14 Güllük<br>Milas - Muğla TURKEY<br>VAT Milas 631 049 0189</td></tr></table>

<table><tr><td>Approval Number</td><td>TR 09-0572</td></tr><tr><td>INVOICE DATE</td><td>21.10.2025</td></tr><tr><td>INVOICE NO</td><td>20252115</td></tr><tr><td>COUNTRY OF ORIGIN</td><td>TURKEY</td></tr></table>

p0_t2:
COMMERCIAL INVOICE

p0_t3:
<table><thead><tr><th>DESCRIPTION OF THE GOODS</th><th>LATIN NAMES</th><th>HS CODE</th><th>QUANTITY (BOXES,PCS)</th><th>PRICE / BOX USD</th><th>TOTAL</th></tr></thead><tbody><tr><td>FROZEN SEABREAM WHOLE ROUND IQF</td><td>(300 - 400 gr)</td><td>SPARUS AURATA</td><td>0303 89 55 00 00</td><td>2400</td><td>$78.000,00</td></tr><tr><td>FROZEN SEABREAM WHOLE ROUND IQF</td><td>(400 - 600 gr)</td><td>SPARUS AURATA</td><td>0303 89 55 00 00</td><td>1500</td><td>$48.750,00</td></tr><tr><td>TOTAL</td><td></td><td></td><td></td><td>3900</td><td>$126750,00</td></tr></tbody><tfoot><tr><td colspan="4"></td><td>TOTAL</td><td>$126750,00</td></tr></tfoot></table>

p0_t4:
<table>
   <tr>
    <td>
     TOTAL PALLETS
    </td>
    <td>
     32 EURO PALLETS
    </td>
   </tr>
   <tr>
    <td>
     PAYMENT TERMS
    </td>
    <td>
     100% PREPAYMENT
    </td>
   </tr>
   <tr>
    <td>
     SHIPPED BY TRUCK
    </td>
    <td>
     68 KL 900 / 33 AIV 007
    </td>
   </tr>
   <tr>
    <td>
     SEAL NUMBER
    </td>
    <td>
     ANT-00674661
    </td>
   </tr>
   <tr>
    <td>
     DELIVERY TERMS
    </td>
    <td>
     FCA / AYDIN/ TURKEY
    </td>
   </tr>
   <tr>
    <td>
     CONTRACT NUMBER &amp; DATE
    </td>
    <td>
     NORDMO25 dd 19.05.2025
    </td>
   </tr>
  </table>

p0_t5:
<table><tr><td>BANK INFORMATION</td><td>Türkiye Vakıflar Bankası T.A.O</td></tr><tr><td>BENEFICIARY</td><td>Noordzee Su Ürünleri İhracatı Sanayi ve Ticaret A.Ş.</td></tr><tr><td>IBAN NO</td><td>TR34 0001 5001 5804 8000 3792 96</td></tr><tr><td>SWIFT</td><td>TVBATR2AXXX</td></tr><tr><td>ADDRESS</td><td>Istanbul Saray Mahallesi Dr. Adnan Büyükdeniz Caddesi No: 7/A-B Umraniye Istanbul Turkey</td></tr></table>
=== END RAW TOKENS ===
-- part 4 (text) --
=== TABLE CANDIDATES ===
p0_t0:
<table><tr><td>CUSTOMER & PLACE OF DELIVERY</td></tr><tr><td>LLC "Moreodor"<br>117292, Moscow, Profsoyuznaya street, 3, office 412<br>Russian Federation<br>INN 7727734159</td></tr></table>

<table><tr><td>EXPORTER</td></tr><tr><td>Noordzee Su Urünleri Ihracatı Sanayi ve Ticaret A.Ş.<br>KOCAKIŞLA MAH. GÜLLÜK YOLU NO:14 Güllük<br>Milas - Muğla TURKEY<br>VAT Milas 631 049 0189</td></tr></table>

<table><tr><td>Approval Number</td><td>TR 09-0572</td></tr><tr><td>INVOICE DATE</td><td>21.10.2025</td></tr><tr><td>INVOICE NO</td><td>20252115</td></tr><tr><td>COUNTRY OF ORIGIN</td><td>TURKEY</td></tr></table>

p0_t3:
<table><thead><tr><th>DESCRIPTION OF THE GOODS</th><th>LATIN NAMES</th><th>HS CODE</th><th>QUANTITY (BOXES,PCS)</th><th>PRICE / BOX USD</th><th>TOTAL</th></tr></thead><tbody><tr><td>FROZEN SEABREAM WHOLE ROUND IQF</td><td>(300 - 400 gr)</td><td>SPARUS AURATA</td><td>0303 89 55 00 00</td><td>2400</td><td>$78.000,00</td></tr><tr><td>FROZEN SEABREAM WHOLE ROUND IQF</td><td>(400 - 600 gr)</td><td>SPARUS AURATA</td><td>0303 89 55 00 00</td><td>1500</td><td>$48.750,00</td></tr><tr><td>TOTAL</td><td></td><td></td><td></td><td>3900</td><td>$126750,00</td></tr></tbody><tfoot><tr><td colspan="4"></td><td>TOTAL</td><td>$126750,00</td></tr></tfoot></table>

p0_t4:
<table>
   <tr>
    <td>
     TOTAL PALLETS
    </td>
    <td>
     32 EURO PALLETS
    </td>
   </tr>
   <tr>
    <td>
     PAYMENT TERMS
    </td>
    <td>
     100% PREPAYMENT
    </td>
   </tr>
   <tr>
    <td>
     SHIPPED BY TRUCK
    </td>
    <td>
     68 KL 900 / 33 AIV 007
    </td>
   </tr>
   <tr>
    <td>
     SEAL NUMBER
    </td>
    <td>
     ANT-00674661
    </td>
   </tr>
   <tr>
    <td>
     DELIVERY TERMS
    </td>
    <td>
     FCA / AYDIN/ TURKEY
    </td>
   </tr>
   <tr>
    <td>
     CONTRACT NUMBER &amp; DATE
    </td>
    <td>
     NORDMO25 dd 19.05.2025
    </td>
   </tr>
  </table>

p0_t5:
<table><tr><td>BANK INFORMATION</td><td>Türkiye Vakıflar Bankası T.A.O</td></tr><tr><td>BENEFICIARY</td><td>Noordzee Su Ürünleri İhracatı Sanayi ve Ticaret A.Ş.</td></tr><tr><td>IBAN NO</td><td>TR34 0001 5001 5804 8000 3792 96</td></tr><tr><td>SWIFT</td><td>TVBATR2AXXX</td></tr><tr><td>ADDRESS</td><td>Istanbul Saray Mahallesi Dr. Adnan Büyükdeniz Caddesi No: 7/A-B Umraniye Istanbul Turkey</td></tr></table>
=== END TABLE CANDIDATES ===
